<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
　　<title>Python 201-Properties</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/css/solarized_light.css">
    <script src="/static/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$', '$'] ],
        displayMath: [ ['$$', '$$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
    });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
　</head>

　<body>
    <div id="wrapper">
      <aside>
        <div class="site-info">lastmayday</div>
        <div class="index">
          <a href="/"><div class="circle home"><span>Home</span></div></a>
          <a href="/blog"><div class="circle blog"><span>Blog</span></div></a>
          <a href="/about.html"><div class="circle about"><span>About</span></div></a>
          <a href="/link.html"><div class="circle link"><span>Link</span></div></a>
        </div>
      </aside>
      <div class="content" role="main">
          <h1>Python 201-Properties</h1>
          <div class="info">02 February 2014</div>
          <br />
          <p><a href="http://www.blog.pythonlibrary.org/2014/01/20/python-201-properties/">原文地址</a></p>

<p><br /></p>

<p>Python有一个整洁的小概念叫做<strong>property</strong>, property可以做很多有用的事情. 在这篇文章里, 我们将会看到怎样做如下的事情:</p>

<ul>
  <li>把类方法转变成只读的属性</li>
  <li>重新实现setters和getters为一个属性</li>
</ul>

<p><br /></p>

<h2 id="section">开始</h2>

<p><br /></p>

<p>使用property最简单的方法是把它作为某个类方法的装饰器. 这允许你把一个类方法变成一个类属性. 我发现当我需要联合一些值的时候这个方法很有用. 让我们看一个简单的例子:</p>

<pre>
<code class="python">
class Person(object):

    def __init__(self, first_name, last_name):
        """Constructor"""
        self.first_name = first_name
        self.last_name = last_name

    @property
    def full_name(self):
        """
        Return the full name
        """
        return "%s %s" % (self.first_name, self.last_name)
</code>
</pre>

<p>在上面的代码中, 我们创建了两个类属性: <code>self.first_name</code> 和 <code>self.last_name</code>. 接着我们创建了一个<code>full_name</code>方法, 这个方法有一个<code>@property</code>装饰器. 这允许我们在一个解释器会话中这样做:</p>

<pre>
<code class="python">
&gt;&gt;&gt; person = Person("Mike", "Driscoll")
&gt;&gt;&gt; person.full_name
'Mike Driscoll'
&gt;&gt;&gt; person.first_name
'Mike'
&gt;&gt;&gt; person.full_name = "Jackalope"
Traceback (most recent call last):
  File "&lt;string&gt;", line 1, in &lt;fragment&gt;
AttributeError: can't set attribute
</code>
</pre>

<p>你可以看到, 因为我们把这个方法变成了一个熟悉, 我们可以用正常的点符号来取得它. 然而, 如果我们尝试把这个属性设置成其他的东西, 我们会导致一个<code>AttributeError</code>被抛出. 唯一能改变<code>full_name</code>属性的方法是这样直接做:</p>

<pre>
<code class="python">
&gt;&gt;&gt; person.first_name = "Dan"
&gt;&gt;&gt; person.full_name
'Dan Driscoll'
</code>
</pre>

<p>这是一种限制, 所以让我们看看另一个例子, 这个例子中我们可以让propery<strong>确实</strong>允许我们设置值.</p>

<p><br /></p>

<h2 id="pythonpropertysettersgetters">用Python的property代替setters和getters</h2>

<p><br /></p>

<p>假设我们有一些遗留代码, 而写这些代码的人对Python掌握得并不是很好. 如果你跟我一样, 你之前可能已经见到过这种代码:</p>

<pre>
<code class="python">
from decimal import Decimal

class Fees(object):
 
    def __init__(self):
        """Constructor"""
        self._fee = None
 
    def get_fee(self):
        """
        Return the current fee
        """
        return self._fee
 
    def set_fee(self, value):
        """
        Set the fee
        """
        if isinstance(value, str):
            self._fee = Decimal(value)
        elif isinstance(value, Decimal):
            self._fee = value
</code>
</pre>

<p>为了使用这个类, 我们不得不使用定义过的setters和getters:</p>

<pre>
<code class="python">
&gt;&gt;&gt; f = Fees()
&gt;&gt;&gt; f.set_fee("1")
&gt;&gt;&gt; f.get_fee()
Decimal('1')
</code>
</pre>

<p>如果你希望使用正常的点符号来获取这段代码的属性, 而不破坏这段代码的所有应用, 你可以简单地添加一个property:</p>

<pre>
<code class="python">
from decimal import Decimal

class Fees(object):

    def __init__(self):
        """Constructor"""
        self._fee = None
 
    def get_fee(self):
        """
        Return the current fee
        """
        return self._fee
 
    def set_fee(self, value):
        """
        Set the fee
        """
        if isinstance(value, str):
            self._fee = Decimal(value)
        elif isinstance(value, Decimal):
            self._fee = value
 
    fee = property(get_fee, set_fee)
</code>
</pre>

<p>我们在代码的最后加了一行代码. 现在我们可以这样做了:</p>

<pre>
<code class="python">
&gt;&gt;&gt; f = Fees()
&gt;&gt;&gt; f.set_fee("1")
&gt;&gt;&gt; f.fee
Decimal('1')
&gt;&gt;&gt; f.fee = "2"
&gt;&gt;&gt; f.get_fee()
Decimal('2')
</code>
</pre>

<p>你可以看到, 当我们这样使用<code>property</code>的时候, 它允许<code>fee</code>属性设置和获取值, 而不破坏这段遗留代码. 让我们用property装饰器重写这段代码, 然后看看我们是否可以让它允许设置.</p>

<pre>
<code class="python">
from decimal import Decimal

class Fees(object):
 
    def __init__(self):
        """Constructor"""
        self._fee = None
 
    @property
    def fee(self):
        """
        The fee property - the getter
        """
        return self._fee
 
    @fee.setter
    def fee(self, value):
        """
        The setter of the fee property
        """
        if isinstance(value, str):
            self._fee = Decimal(value)
        elif isinstance(value, Decimal):
            self._fee = value
 
if __name__ == "__main__":
    f = Fees()
</code>
</pre>

<p>上面的代码示例了怎样给<code>fee</code>属性创建一个<code>setter</code>. 你可以通过用叫做<code>@fee.setter</code>的装饰器来装饰一个也叫做<code>fee</code>的第二方法. 当你这样做的时候这个setter会被调用:</p>

<pre>
<code class="python">
&gt;&gt;&gt; f = Fees()
&gt;&gt;&gt; f.fee = "1"
</code>
</pre>

<p>如果你看一下<code>property</code>的参数, 会发现它有<code>fget</code>, <code>fset</code>, <code>fdel</code>以及<code>doc</code>. 如果你想捕获这个属性的<code>del</code>命令的话, 可以使用同一个名字创建另一个被<code>@fee.deleter</code>装饰的方法来对应一个删除方法.</p>

<p><br /></p>

<h2 id="section-1">结束语</h2>

<p><br /></p>

<p>现在你知道怎么在你自己的类中使用Python的properties了. 希望你可以在自己的代码中发现更多有用的方式.</p>

<p><br /></p>

<h2 id="section-2">额外阅读</h2>

<ul>
  <li><a href="http://eli.thegreenplace.net/2009/02/06/getters-and-setters-in-python/">Getters and setter in Python</a></li>
  <li>Official Python <a href="http://docs.python.org/2/library/functions.html#property">documentation on property</a></li>
  <li>A discussion on adding docstrings to a Python property on <a href="https://stackoverflow.com/questions/16025462/what-is-the-right-way-to-put-a-docstring-on-python-property">StackOverflow</a></li>
</ul>

<p><br /></p>


          
          <div class="tags">
            <span>标签: </span>
            <ul>
            
              <li>Python</li>
            
            </ul>
          </div>
          
          <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_shortname = 'lastmayday-github'; // required: replace example with your forum shortname
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
      <footer role="contentinfo">
        <p>Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://pages.github.com/">Github Pages</a></p>
        <p> &copy lastmayday 2013-2015 | All Rights Reserved. </p>
      </footer>
    </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38333678-2']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
